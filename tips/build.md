#ビルドツール

Contents
<ol class='goog-toc'><li class='goog-toc'>[<strong>1 </strong>ビルドしたバイナリを実行する](#TOC--)</li><li class='goog-toc'>[<strong>2 </strong>ディレクトリ構造を保存した状態でインストールを行う](#TOC--1)</li></ol>


<h4>ビルドしたバイナリを実行する</h4>bjamでバイナリをビルドした場合、toolsetやvariantによって最終生成物が非常に深い位置に生成される。これを実行するのはインストールするまで困難であるが、notfileモジュールを使用することで実現できる。<pre style='margin-bottom:0px'><pre>```cpp
<code style='color:rgb(0,0,0)'>import notfile ;
 
project /sample ;
 
exe executable : source.cpp ;
  
actions exec_executable
{
        $(2)
}
 
notfile exec : @exec_executable : /sample//executable ;
explicit exec ;</code>
</pre></pre>explicitルールを指定しないと意図しないタイミングで実行されてしまうので注意されたい。```cpp
`$ cat source.cpp`<code style='color:rgb(0,0,0)'>#include <iostream></code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>int main()</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>{</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>    std::cout << __GNUC__ << "." << __GNUC_MINOR__ << std::endl;</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>}</code>`$ bjam --toolset=gcc-4.5`<code style='color:rgb(0,0,0)'>...found 9 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updating 5 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir bin</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir bin/gcc-4.5</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir bin/gcc-4.5/debug</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>gcc.compile.c++ bin/gcc-4.5/debug/source.o</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>gcc.link bin/gcc-4.5/debug/executable</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updated 5 targets...</code>`$ bjam --toolset=gcc-4.6`<code style='color:rgb(0,0,0)'>...found 9 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updating 4 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir bin/gcc-4.6</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir bin/gcc-4.6/debug</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>gcc.compile.c++ bin/gcc-4.6/debug/source.o</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>gcc.link bin/gcc-4.6/debug/executable</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updated 4 targets...</code>`$ bjam --toolset=gcc-4.5 exec`<code style='color:rgb(0,0,0)'>...found 10 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updating 1 target...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>Jamfile</home/boosters>.exec_executable <l./gcc-4.5/debug>exec</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>4.5</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(0,0,0)'>...updated 1 target...</code>`$ bjam --toolset=gcc-4.6 exec`<code style='color:rgb(0,0,0)'>...found 10 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updating 1 target...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>Jamfile</home/boosters>.exec_executable <l./gcc-4.6/debug>exec</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>4.6</code><code style='color:rgb(0,0,0)'>...updated 1 target...</code>
実行時はビルド時と同じtoolset,variantを指定する必要がある。ビルドされていない場合、ビルドを行ってから実行する。<h4>ディレクトリ構造を保存した状態でインストールを行う</h4>通常インストールターゲットを定義する際、packageモジュールのinstallルールを用いることが多い。しかし、これはヘッダファイルのディレクトリ構造をデフォルトで保存しない。ヘッダファイルを細かく分けることの多いC++などではこの動作は使いにくい。以下にデフォルトの動作を例示する。```cpp
`<span style='color:rgb(0,0,0)'># Jamroot.jamimport package ;</span><br style='color:rgb(0,0,0)'/>import path ;<br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/>path-constant project-root : [ path.make ./ ] ;<br style='color:rgb(0,0,0)'/>project /sample ;<br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/>explicit install ;<br style='color:rgb(0,0,0)'/><span style='color:rgb(255,0,0)'>package.install install</span><br style='color:rgb(0,0,0)'/>  : # requirements<br style='color:rgb(0,0,0)'/>  : # binaries<br style='color:rgb(0,0,0)'/>  : # libraries<br style='color:rgb(0,0,0)'/>  : <span style='color:rgb(39,78,19)'>[ path.glob-tree $(project-root) : *.hpp ]</span><br style='color:rgb(0,0,0)'/>  ;`
```cpp
<code style='color:rgb(0,0,0)'>$ ls -R</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>.:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>Jamroot.jam  sample/</code><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/><code style='color:rgb(255,0,0)'>./sample:</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>detail/  sample.hpp</code><br style='color:rgb(255,0,0)'/><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>./sample/detail:</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>sample1.hpp</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>$ bjam install --prefix=$HOME/local</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...found 10 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updating 3 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir /home/boosters/local/include</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(255,0,0)'>common.copy /home/boosters/local/include/sample.hpp</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>common.copy /home/boosters/local/include/sample1.hpp</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updated 3 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>$ ls -R $HOME/local</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>/home/boosters/local:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>include/</code><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/><code style='color:rgb(255,0,0)'>/home/boosters/local/include:</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>sample1.hpp  sample.hpp</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>$</code>
これを回避するには<install-source-root>を使用すればよい。具体的には以下のようになる。<span style='color:rgb(0,0,0)'></span>```cpp
<code style='color:rgb(0,0,0)'># Jamroot.jam</code><code style='color:rgb(0,0,0)'>import package ;</code><br style='color:rgb(0,0,0)'/>`<span style='color:rgb(0,0,0)'>import path ;`</span><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/>`<span style='color:rgb(0,0,0)'>path-constant project-root : [ path.make ./ ] ;`</span><br style='color:rgb(0,0,0)'/>`<span style='color:rgb(0,0,0)'>project /sample ;`</span><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/>`<span style='color:rgb(0,0,0)'>explicit install ;`</span><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>package.install</code>`<span style='color:rgb(0,0,0)'> install`</span>`  <span style='color:rgb(0,0,0)'>: <span style='color:rgb(255,0,0)'><install-source-root>$(project-root)</span>`</span><br style='color:rgb(0,0,0)'/>`  <span style='color:rgb(0,0,0)'>: # binaries`</span><br style='color:rgb(0,0,0)'/>`  <span style='color:rgb(0,0,0)'>: # libraries`</span><br style='color:rgb(0,0,0)'/>`<span style='color:rgb(0,0,0)'>  : ``<span style='color:rgb(39,78,19)'>[ path.glob-tree $(project-root) : *.hpp ]  ;</span>`</span>
<code style='color:rgb(0,0,0)'>$ ls -R</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>.:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>Jamroot.jam  sample/</code><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>./sample:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>detail/  sample.hpp</code><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>./sample/detail:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>sample1.hpp</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>$ bjam install --prefix=$HOME/local</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...found 12 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updating 5 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir /home/boosters/local/include</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>common.mkdir /home/boosters/local/include/sample</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>common.copy /home/boosters/local/include/sample/sample.hpp</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>common.mkdir /home/boosters/local/include/sample/detail</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>common.copy /home/boosters/local/include/sample/detail/sample1.hpp</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>...updated 5 targets...</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>$ ls -R $HOME/local</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>/home/boosters/local:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>include/</code><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>/home/boosters/local/include:</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>sample/</code><br style='color:rgb(0,0,0)'/><br style='color:rgb(0,0,0)'/><code style='color:rgb(255,0,0)'>/home/boosters/local/include/sample:</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>detail/  sample.hpp</code><br style='color:rgb(255,0,0)'/><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>/home/boosters/local/include/sample/detail:</code><br style='color:rgb(255,0,0)'/><code style='color:rgb(255,0,0)'>sample1.hpp</code><br style='color:rgb(0,0,0)'/><code style='color:rgb(0,0,0)'>$      </code>
